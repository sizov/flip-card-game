!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("wolfy87-eventemitter")):"function"==typeof define&&define.amd?define(["wolfy87-eventemitter"],t):"object"==typeof exports?exports["flip-card-game"]=t(require("wolfy87-eventemitter")):e["flip-card-game"]=t(e["wolfy87-eventemitter"])}(this,function(e){return function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.flipCardStates=t.flipCardGameEvents=t.FlipCardGame=void 0;var n=r(6),i=a(n),u=r(1),l=a(u),o=r(2),d=a(o);t.FlipCardGame=i.default,t.flipCardGameEvents=d.default,t.flipCardStates=l.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={FACE:"face",BACK:"back"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={CARD_FLIP_EVENT:"cardFlipEvent",PLAYER_FOUND_PAIR_EVENT:"playerFoundPairEvent",PLAYER_MISSED_PAIR_EVENT:"playerMissedPairEvent",PLAYER_FINISHED_FLIPPING_PAIR_EVENT:"playerFinishedFlippingPairEvent",GAME_OVER_EVENT:"gameOverEvent",GAME_DRAW_EVENT:"gameDrawEvent"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={OVER:"gameOver",DRAW:"drawGame",PLAYING:"playingGame",NEW:"newGame"}},function(e,t){"use strict";function r(){var e=a.toString();return a+=1,e}Object.defineProperty(t,"__esModule",{value:!0});var a=0;t.default={generate:r}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){e=Object.assign({},d,e);var t=u.default.generate();this.getId=function(){return t},this.getState=function(){return e.state},this.getPairId=function(){return e.pairId},this.setState=function(t){if(t!==o.default.BACK&&t!==o.default.FACE)throw new Error("Unexpected state "+t);e.state=t},this.flip=function(){e.state===o.default.FACE?this.setState(o.default.BACK):e.state===o.default.BACK&&this.setState(o.default.FACE)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),u=a(i),l=r(1),o=a(l),d={state:o.default.BACK,pairId:void 0};t.default=n},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){function t(e){e.state===u.default.OVER?r.emit(o.default.GAME_OVER_EVENT,{winner:e.winners[0]}):e.state===u.default.DRAW&&r.emit(o.default.GAME_DRAW_EVENT,{winners:e.winners})}e=Object.assign({},_,e);var r=new v.default;this.on=r.on.bind(r),this.emit=r.emit.bind(r),this.getState=function(){return f.default.getGameState({cards:l,cardsFlippedByPlayers:s,pairsFoundByPlayers:d,currentPlayer:a})};var a;this.getCurrentPlayer=function(){return a};var n=[],i=e.players||y.default.generate(e.playersAmount);this.getPlayers=function(){return i};var l=e.cards||c.default.generate(e.cardsAmount);this.getCards=function(){return l};var d=new Map,s=new Map;this.flipCard=function(e){e=e||{};var u=f.default.getCardToFlip({cardId:e.cardId,card:e.card,cards:l});if(a=f.default.getPlayerToFlipCard({playerId:e.playerId,player:e.player,lastPlayerMadeFlip:a,players:i,cardsFlippedByPlayers:s}),u.flip(),s.get(a).push(u),n.push(u),r.emit(o.default.CARD_FLIP_EVENT,{card:u,player:a}),2===n.length){var c=[o.default.PLAYER_FINISHED_FLIPPING_PAIR_EVENT];f.default.cardsArePair(n[0],n[1])?(d.get(a).push(n.slice()),c.push(o.default.PLAYER_FOUND_PAIR_EVENT)):(n.forEach(function(e){return e.flip()}),c.push(o.default.PLAYER_MISSED_PAIR_EVENT)),c.forEach(function(e){r.emit(e,{cards:n,player:a})}),n=[]}t(this.getState()),2===n.length&&(a=void 0)},i.forEach(function(e){d.set(e,[]),s.set(e,[])})}Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),u=a(i),l=r(2),o=a(l),d=r(9),f=a(d),s=r(8),c=a(s),p=r(10),y=a(p),E=r(11),v=a(E),_={playersAmount:2,cardsAmount:10};t.default=n},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){e=Object.assign({},l,e);var t=u.default.generate();this.getId=function(){return t}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),u=a(i),l={};t.default=n},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){if(0>e)throw new Error("Amount should not be less than zero");for(var t=[],r=0,a=0;e>a;a++)t.push(new u.default({pairId:r.toString()})),a%2!==0&&(r+=1);return t}Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),u=a(i);t.default={generate:n}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(){}function i(){}function u(e){if("undefined"==typeof e.lastPlayerMadeFlip)return!0;var t=e.cardsFlippedByPlayers.get(e.lastPlayerMadeFlip),r=t.length%2===0;if(r){if(e.player===e.lastPlayerMadeFlip)return!1}else if(e.player!==e.lastPlayerMadeFlip)return!1;return!0}function l(e){var t=function(t){return t===e.object},r=function(t){return t.getId()===e.id},a="undefined"!=typeof e.id?r:t,n=e.objects.filter(a);if(0===n.length)throw new Error("Error finding object");return n[0]}function o(e){e=e||{};var t;if(t=e.player||e.playerId?l({id:e.playerId,object:e.player,objects:e.players}):n(),!u({player:t,lastPlayerMadeFlip:e.lastPlayerMadeFlip,cardsFlippedByPlayers:e.cardsFlippedByPlayers}))throw new Error("Player "+t.getId()+" can't flip cards now");if(!t)throw new Error("Error finding next valid player");return t}function d(e){e=e||{};var t;if(t=e.card||e.cardId?l({id:e.cardId,object:e.card,objects:e.cards}):i(),!t)throw new Error("Error finding next card to flip");if(t.getState()===y.default.FACE)throw new Error("Error flipping card "+t.getId()+" as it is flipped already");return t}function f(e){var t=Math.floor(e.cards.length/2),r=Math.floor(t/2)+1,a=new Map,n=0,i=0,u=!0,l=!1,o=void 0;try{for(var d,f=e.pairsFoundByPlayers[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var s=c(d.value,2),p=s[0],y=s[1],E=y.length;if(n+=E,E>=r)return[p];E>i&&(i=E),a.has(E)||a.set(E,[]),a.get(E).push(p)}}catch(v){l=!0,o=v}finally{try{!u&&f.return&&f.return()}finally{if(l)throw o}}var _=t-n,h=a.get(i);if(0===_)return h.slice();if(h.length>1)return[];var P=!0,g=!1,A=void 0;try{for(var w,I=a[Symbol.iterator]();!(P=(w=I.next()).done);P=!0){var m=c(w.value,1),F=m[0];if(F+_>=i)return[]}}catch(v){g=!0,A=v}finally{try{!P&&I.return&&I.return()}finally{if(g)throw A}}return h.slice()}function s(e){if(!e.currentPlayer)return{state:v.default.NEW};var t=f({cards:e.cards,pairsFoundByPlayers:e.pairsFoundByPlayers});return 0===t.length?{state:v.default.PLAYING}:1===t.length?{state:v.default.OVER,winners:t}:{state:v.default.DRAW,winners:t}}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){var r=[],a=!0,n=!1,i=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done)&&(r.push(u.value),!t||r.length!==t);a=!0);}catch(o){n=!0,i=o}finally{try{!a&&l.return&&l.return()}finally{if(n)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=r(1),y=a(p),E=r(3),v=a(E),_=function(e,t){return e.getPairId()===t.getPairId()};t.default={cardsArePair:_,getGameState:s,getPlayerToFlipCard:o,getCardToFlip:d,getWinners:f}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){if(0>e)throw new Error("Amount should not be less than zero");for(var t=[],r=0;e>r;r++)t.push(new u.default);return t}Object.defineProperty(t,"__esModule",{value:!0});var i=r(7),u=a(i);t.default={generate:n}},function(t,r){t.exports=e}])});