!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("wolfy87-eventemitter")):"function"==typeof define&&define.amd?define(["wolfy87-eventemitter"],t):"object"==typeof exports?exports["flip-card-game"]=t(require("wolfy87-eventemitter")):e["flip-card-game"]=t(e["wolfy87-eventemitter"])}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(6),u=n(a),i=r(1),o=n(i),l=r(2),d=n(l);t.default={FlipCardGame:u.default,cardStates:o.default,events:d.default}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={FACE:"face",BACK:"back"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={CARD_FLIP_EVENT:"cardFlipEvent",PLAYER_FOUND_PAIR_EVENT:"playerFoundPairEvent",PLAYER_MISSED_PAIR_EVENT:"playerMissedPairEvent",PLAYER_FINISHED_FLIPPING_PAIR_EVENT:"playerFinishedFlippingPairEvent",GAME_OVER_EVENT:"gameOverEvent",GAME_DRAW_EVENT:"gameDrawEvent"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={OVER:"gameOver",DRAW:"drawGame",PLAYING:"playingGame",NEW:"newGame"}},function(e,t){"use strict";function r(){var e=n.toString();return n+=1,e}Object.defineProperty(t,"__esModule",{value:!0});var n=0;t.default={generate:r}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){e=Object.assign({},d,e);var t=i.default.generate();this.getId=function(){return t},this.getState=function(){return e.state},this.getPairId=function(){return e.pairId},this.setState=function(t){if(t!==l.default.BACK&&t!==l.default.FACE)throw new Error("Unexpected state "+t);e.state=t},this.flip=function(){e.state===l.default.FACE?this.setState(l.default.BACK):e.state===l.default.BACK&&this.setState(l.default.FACE)}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(4),i=n(u),o=r(1),l=n(o),d={state:l.default.BACK,pairId:void 0};t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){function t(e){e.state===i.default.OVER?r.emit(l.default.GAME_OVER_EVENT,{winner:e.winners[0]}):e.state===i.default.DRAW&&r.emit(l.default.GAME_DRAW_EVENT,{winners:e.winners})}e=Object.assign({},_,e);var r=new E.default;this.on=r.on.bind(r),this.emit=r.emit.bind(r),this.getState=function(){return f.default.getGameState({cards:o,cardsFlippedByPlayers:s,pairsFoundByPlayers:d,currentPlayer:n})};var n;this.getCurrentPlayer=function(){return n};var a=[],u=e.players||y.default.generate(e.playersAmount);this.getPlayers=function(){return u};var o=e.cards||c.default.generate(e.cardsAmount);this.getCards=function(){return o};var d=new Map,s=new Map;this.flipCard=function(e){e=e||{};var i=f.default.getCardToFlip({cardId:e.cardId,card:e.card,cards:o});if(n=f.default.getPlayerToFlipCard({playerId:e.playerId,player:e.player,currentPlayer:n,players:u,cardsFlippedByPlayers:s}),i.flip(),s.get(n).push(i),a.push(i),r.emit(l.default.CARD_FLIP_EVENT,{card:i,player:n}),2===a.length){var c=[l.default.PLAYER_FINISHED_FLIPPING_PAIR_EVENT];f.default.cardsArePair(a[0],a[1])?(d.get(n).push(a.slice()),c.push(l.default.PLAYER_FOUND_PAIR_EVENT)):(a.forEach(function(e){return e.flip()}),c.push(l.default.PLAYER_MISSED_PAIR_EVENT)),c.forEach(function(e){r.emit(e,{cards:a,player:n})}),a=[]}t(this.getState()),2===a.length&&(n=void 0)},u.forEach(function(e){d.set(e,[]),s.set(e,[])})}Object.defineProperty(t,"__esModule",{value:!0});var u=r(3),i=n(u),o=r(2),l=n(o),d=r(9),f=n(d),s=r(8),c=n(s),p=r(10),y=n(p),v=r(11),E=n(v),_={playersAmount:2,cardsAmount:10};t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){e=Object.assign({},o,e);var t=i.default.generate();this.getId=function(){return t}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(4),i=n(u),o={};t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(0>e)throw new Error("Amount should not be less than zero");for(var t=[],r=0,n=0;e>n;n++)t.push(new i.default({pairId:r.toString()})),n%2!==0&&(r+=1);return t}Object.defineProperty(t,"__esModule",{value:!0});var u=r(5),i=n(u);t.default={generate:a}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(){}function u(){}function i(e){var t=e.cardsFlippedByPlayers.get(e.player),r=!0,n=!1,a=void 0;try{for(var u,i=e.cardsFlippedByPlayers[Symbol.iterator]();!(r=(u=i.next()).done);r=!0){var o=c(u.value,2),l=(o[0],o[1]);if(t.length-l.length>=2)return!1}}catch(d){n=!0,a=d}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}return!0}function o(e){var t=function(t){return t===e.object},r=function(t){return t.getId()===e.id},n="undefined"!=typeof e.id?r:t,a=e.objects.filter(n);if(0===a.length)throw new Error("Error finding object");return a[0]}function l(e){e=e||{};var t;if(t=e.player||e.playerId?o({id:e.playerId,object:e.player,objects:e.players}):a(),!i({player:t,cardsFlippedByPlayers:e.cardsFlippedByPlayers}))throw new Error("Player "+t.getId()+" can't flip cards now");if(!t)throw new Error("Error finding next valid player");return t}function d(e){e=e||{};var t;if(t=e.card||e.cardId?o({id:e.cardId,object:e.card,objects:e.cards}):u(),!t)throw new Error("Error finding next card to flip");if(t.getState()===y.default.FACE)throw new Error("Error flipping card "+t.getId()+" as it is flipped already");return t}function f(e){var t=Math.floor(e.cards.length/2),r=Math.floor(t/2)+1,n=new Map,a=0,u=0,i=!0,o=!1,l=void 0;try{for(var d,f=e.pairsFoundByPlayers[Symbol.iterator]();!(i=(d=f.next()).done);i=!0){var s=c(d.value,2),p=s[0],y=s[1],v=y.length;if(a+=v,v>=r)return[p];v>u&&(u=v),n.has(v)||n.set(v,[]),n.get(v).push(p)}}catch(E){o=!0,l=E}finally{try{!i&&f.return&&f.return()}finally{if(o)throw l}}var _=t-a,h=n.get(u);if(0===_)return h.slice();if(h.length>1)return[];var g=!0,P=!1,A=void 0;try{for(var w,I=n[Symbol.iterator]();!(g=(w=I.next()).done);g=!0){var m=c(w.value,1),b=m[0];if(b+_>=u)return[]}}catch(E){P=!0,A=E}finally{try{!g&&I.return&&I.return()}finally{if(P)throw A}}return h.slice()}function s(e){if(!e.currentPlayer)return{state:E.default.NEW};var t=f({cards:e.cards,pairsFoundByPlayers:e.pairsFoundByPlayers});return 0===t.length?{state:E.default.PLAYING}:1===t.length?{state:E.default.OVER,winners:t}:{state:E.default.DRAW,winners:t}}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){var r=[],n=!0,a=!1,u=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(l){a=!0,u=l}finally{try{!n&&o.return&&o.return()}finally{if(a)throw u}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=r(1),y=n(p),v=r(3),E=n(v),_=function(e,t){return e.getPairId()===t.getPairId()};t.default={cardsArePair:_,getGameState:s,getPlayerToFlipCard:l,getCardToFlip:d,getWinners:f}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(0>e)throw new Error("Amount should not be less than zero");for(var t=[],r=0;e>r;r++)t.push(new i.default);return t}Object.defineProperty(t,"__esModule",{value:!0});var u=r(7),i=n(u);t.default={generate:a}},function(t,r){t.exports=e}])});