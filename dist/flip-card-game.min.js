!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("wolfy87-eventemitter")):"function"==typeof define&&define.amd?define(["wolfy87-eventemitter"],t):"object"==typeof exports?exports["flip-card-game"]=t(require("wolfy87-eventemitter")):e["flip-card-game"]=t(e["wolfy87-eventemitter"])}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(6),u=n(a),i=r(1),o=n(i),d=r(2),l=n(d);t.default={FlipCardGame:u.default,cardStates:o.default,events:l.default}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={FACE:"face",BACK:"back"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={CARD_FLIP_EVENT:"cardFlipEvent",PLAYER_FOUND_PAIR_EVENT:"playerFoundPairEvent",PLAYER_FINISHED_FLIPPING_PAIR_EVENT:"playerFinishedFlippingPairEvent",GAME_OVER_EVENT:"gameOverEvent",GAME_DRAW_EVENT:"gameDrawEvent"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={OVER:"gameOver",DRAW:"drawGame",PLAYING:"playingGame",NEW:"newGame"}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(10),u=n(a);t.default=function(e){return{getId:function(){return"undefined"==typeof e.id?u.default.generate():e.id}}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){function t(t){if(t!==i.default.BACK&&t!==i.default.FACE)throw new Error("Unexpected state "+t);e.state=t}function r(){e.state===i.default.FACE?t(i.default.BACK):e.state===i.default.BACK&&t(i.default.FACE)}e=Object.assign({},l,e);var n=function(){return e.state},a=function(){return e.pairId};return Object.assign({},(0,d.default)({id:e.id}),{getState:n,setState:t,getPairId:a,flip:r})}Object.defineProperty(t,"__esModule",{value:!0});var u=r(1),i=n(u),o=r(4),d=n(o),l={id:void 0,state:i.default.BACK,pairId:void 0};t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){function t(e){e.state===i.default.OVER?r.emit(d.default.GAME_OVER_EVENT,{winner:e.winners[0]}):e.state===i.default.DRAW&&r.emit(d.default.GAME_DRAW_EVENT,{winners:e.winners})}e=Object.assign({},E,e);var r=new _.default;this.on=r.on.bind(r),this.emit=r.emit.bind(r),this.getState=function(){return f.default.getGameState({cards:o,cardsFlippedByPlayers:s,pairsFoundByPlayers:l,currentPlayer:n})};var n;this.getCurrentPlayer=function(){return n};var a=[],u=e.players||y.default.generate(e.playersAmount);this.getPlayers=function(){return u};var o=e.cards||c.default.generate(e.cardsAmount);this.getCards=function(){return o};var l=new Map,s=new Map;this.flipCard=function(e){e=e||{};var i=f.default.getCardToFlip({cardId:e.cardId,card:e.card,cards:o});n=f.default.getPlayerToFlipCard({playerId:e.playerId,player:e.player,currentPlayer:n,players:u,cardsFlippedByPlayers:s}),i.flip(),s.get(n).push(i),a.push(i),r.emit(d.default.CARD_FLIP_EVENT,{card:i,player:n}),2===a.length&&(f.default.cardsArePair(a[0],a[1])?(r.emit(d.default.PLAYER_FOUND_PAIR_EVENT,{cards:a,player:n}),l.get(n).push(a.slice())):(a[0].flip(),a[1].flip()),r.emit(d.default.PLAYER_FINISHED_FLIPPING_PAIR_EVENT,{cards:a,player:n}),a=[]),t(this.getState()),2===a.length&&(n=void 0)},u.forEach(function(e){l.set(e,[]),s.set(e,[])})}Object.defineProperty(t,"__esModule",{value:!0});var u=r(3),i=n(u),o=r(2),d=n(o),l=r(9),f=n(l),s=r(8),c=n(s),p=r(11),y=n(p),v=r(12),_=n(v),E={playersAmount:2,cardsAmount:10};t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){return e=Object.assign({},o,e),Object.assign({},(0,i.default)({id:e.id}))}Object.defineProperty(t,"__esModule",{value:!0});var u=r(4),i=n(u),o={id:void 0};t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(0>e)throw new Error("Amount should not be less than zero");for(var t=[],r=0,n=0;e>n;n++)t.push(new i.default({pairId:r.toString()})),n%2!==0&&(r+=1);return t}Object.defineProperty(t,"__esModule",{value:!0});var u=r(5),i=n(u);t.default={generate:a}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(){}function u(){}function i(){return!0}function o(e){var t=function(t){return t===e.object},r=function(t){return t.getId()===e.id},n="undefined"!=typeof e.id?r:t,a=e.objects.filter(n);if(0===a.length)throw new Error("Error finding object");return a[0]}function d(e){e=e||{};var t;if(t=e.player||e.playerId?o({id:e.playerId,object:e.player,objects:e.players}):a(),!i(t))throw new Error("Player "+t.getId()+" can't flip cards now");if(!t)throw new Error("Error finding next valid player");return t}function l(e){e=e||{};var t;if(t=e.card||e.cardId?o({id:e.cardId,object:e.card,objects:e.cards}):u(),!t)throw new Error("Error finding next card to flip");if(t.getState()===y.default.FACE)throw new Error("Error flipping card "+t.getId()+" as it is flipped already");return t}function f(e){var t=Math.floor(e.cards.length/2),r=Math.floor(t/2)+1,n=new Map,a=0,u=0,i=!0,o=!1,d=void 0;try{for(var l,f=e.pairsFoundByPlayers[Symbol.iterator]();!(i=(l=f.next()).done);i=!0){var s=c(l.value,2),p=s[0],y=s[1],v=y.length;if(a+=v,v>=r)return[p];v>u&&(u=v),n.has(v)||n.set(v,[]),n.get(v).push(p)}}catch(_){o=!0,d=_}finally{try{!i&&f.return&&f.return()}finally{if(o)throw d}}var E=t-a,g=n.get(u);if(0===E)return g.slice();if(g.length>1)return[];var h=!0,P=!1,w=void 0;try{for(var A,b=n[Symbol.iterator]();!(h=(A=b.next()).done);h=!0){var m=c(A.value,1),I=m[0];if(I+E>=u)return[]}}catch(_){P=!0,w=_}finally{try{!h&&b.return&&b.return()}finally{if(P)throw w}}return g.slice()}function s(e){if(!e.currentPlayer)return{state:_.default.NEW};var t=f({cards:e.cards,pairsFoundByPlayers:e.pairsFoundByPlayers});return 0===t.length?{state:_.default.PLAYING}:1===t.length?{state:_.default.OVER,winners:t}:{state:_.default.DRAW,winners:t}}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){var r=[],n=!0,a=!1,u=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(d){a=!0,u=d}finally{try{!n&&o.return&&o.return()}finally{if(a)throw u}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=r(1),y=n(p),v=r(3),_=n(v),E=function(e,t){return e.getPairId()===t.getPairId()};t.default={cardsArePair:E,getGameState:s,getPlayerToFlipCard:d,getCardToFlip:l,getWinners:f}},function(e,t){"use strict";function r(){return 0!==n&&(n+=1),n.toString()}Object.defineProperty(t,"__esModule",{value:!0});var n=0;t.default={generate:r}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(0>e)throw new Error("Amount should not be less than zero");for(var t=[],r=0;e>r;r++)t.push(new i.default({id:r}));return t}Object.defineProperty(t,"__esModule",{value:!0});var u=r(7),i=n(u);t.default={generate:a}},function(t,r){t.exports=e}])});